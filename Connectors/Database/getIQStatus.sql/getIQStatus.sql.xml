<?xml version="1.0" encoding="UTF-8"?>
<jdbc:descriptor wsdlLocation="getIQStatus.sql.wsdl" targetNamespace="urn:intalio.com:connectors:database:launchpointprocess:getiqstatusservice" xmlns:jdbc="http://bpms.intalio.com/connectors/jdbc/">
    <jdbc:service name="getIQStatusService">
        <jdbc:operation name="urn:getIQStatus" sqlStatement="select
	casetracking.caseid,
	letterNumber,
	case 
		when (iqlettertracking.iqenqueued is null) or  (iqlettertracking.iqenqueued = false) THEN 'Processing'
		when iqlettertracking.iqenqueued = true then
			case 
				when (iqlettertracking.iqsent is null) or (iqlettertracking.iqsent = false) THEN 'Waiting'
				when iqlettertracking.iqsent = true then
					case
						when (iqlettertracking.iqresponsereceived is null) or (iqlettertracking.iqresponsereceived = false) then 'Sent'
						when (iqlettertracking.iqresponsereceived = true) then 'ResponseReceived'
					end
			end
		end as Status,
	iqlettertracking.iqresponse
from 
	casetracking 
	inner join iqtracking on (casetracking.caseid = iqtracking.caseid)
	inner join iqlettertracking on (iqtracking.caseid= iqlettertracking.caseid)
where
	casetracking.casetype='IQ' and casetracking.caseid = ?
group by
	casetracking.caseid,iqlettertracking.letternumber,Status,iqlettertracking.iqresponse
order by
	iqlettertracking.letternumber desc
limit 1" event="false" dynamicCredentials="true" xmlns:urn="urn:intalio.com:connectors:database:launchpointprocess:getiqstatusservice">
            <jdbc:input>
                <jdbc:parameter>
                    <jdbc:mode>1</jdbc:mode>
                    <jdbc:name>caseid</jdbc:name>
                    <jdbc:type>20</jdbc:type>
                    <jdbc:length>0</jdbc:length>
                    <jdbc:typeName xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                    <jdbc:precision>15</jdbc:precision>
                    <jdbc:scale>2</jdbc:scale>
                    <jdbc:nullable>false</jdbc:nullable>
                    <jdbc:index>0</jdbc:index>
                </jdbc:parameter>
            </jdbc:input>
            <jdbc:filter rowsToSendService="1" rowsToFetch="-1" duration="-PT1S">
                <jdbc:unique scope="none"/>
            </jdbc:filter>
            <jdbc:output/>
        </jdbc:operation>
        <jdbc:port>
            <jdbc:address location="http://bpms.everteam.us:8080/everteam/ode/processes/getIQStatusService"/>
        </jdbc:port>
        <jdbc:connection jndiName="java:comp/env/jdbc/BAMDB">
            <jdbc:databaseProductName>Generic JDBC</jdbc:databaseProductName>
            <jdbc:databaseProductVersion>1.0</jdbc:databaseProductVersion>
            <jdbc:driverClass>org.postgresql.Driver</jdbc:driverClass>
            <jdbc:databaseUrl>jdbc:postgresql://bpms.everteam.us:5432/bamdb</jdbc:databaseUrl>
            <jdbc:databaseName>BAMDB</jdbc:databaseName>
            <jdbc:userName>bam</jdbc:userName>
            <jdbc:password>decrypt[2CngLiBezswySgotQzsilWcf4pDLKedH]</jdbc:password>
        </jdbc:connection>
    </jdbc:service>
</jdbc:descriptor>